<html>
<head>
    <title>Comment Page!</title>
    <style>
        body {
            font-family: JetBrains Mono,monospace;
            background: #000;
            color: #eee;
            padding: 40px;
            max-width: 700px;
            margin: auto;
        }

        h1, h3 {
            text-align: center;
            color: #fff;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #444;
            background: #111;
            color: #eee;
        }

        button {
            background: #222;
            color: #eee;
            border: 1px solid #444;
            padding: 10px 15px;
            margin: 5px 3px;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }

        button:hover {
            background: #333;
        }

        .hidden {
            display: none;
        }

        #comment-list {
            border-top: 1px solid #444;
            margin-top: 20px;
            padding-top: 10px;
        }
        .comment {
            background: #111;
            padding: 12px;
            margin: 12px 0;
            border-radius: 6px;
            border: 1px solid #333;
        }

        small {
            color: #aaa;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
<h1>Comment Page!</h1>

<div id="login-section">
    <input type="text" id="username" placeholder="Enter your name">
    <button onclick="login()">Login</button>
</div>

<div id="main-content" class="hidden">
    <p>Welcome, <span id="display-name"></span>!</p>

    <textarea id="comment-input" placeholder="Write a comment..."></textarea><br>
    <button onclick="addComment()">Post Comment</button>
    <button onclick="logout()">Log Out</button>

    <h3>Comments:</h3>
    <div id="comment-list">
    </div>
</div>

<script>
    let currentUser = "";

    let allComments = JSON.parse(localStorage.getItem('mySiteComments')) || [];

    function login() {
        const nameInput = document.getElementById('username').value;
        if (nameInput.trim() !== "") {
            currentUser = nameInput;
            document.getElementById('display-name').innerText = currentUser;

            // now hide the login and show the comments
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            renderComments();
        }
    }

    function addComment() {
        const text = document.getElementById('comment-input').value;
        if (text.trim() === "") return;

        const newComment = {
            user: currentUser,
            text: text,
            timestamp: new Date().toLocaleString()
        }

        allComments.unshift(newComment);

        localStorage.setItem('mySiteComments', JSON.stringify(allComments));
        renderComments();
        document.getElementById('comment-input').value = "";
    }

    //vulnerability here!
    function renderComments(){
        const list = document.getElementById('comment-list');
        list.innerHTML = "";
        allComments.forEach(comment => {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment';

            commentDiv.innerHTML = `
                    <strong>${comment.user}</strong> <small>(${comment.timestamp})</small>
                    <p>${comment.text}</p>
                `;
            list.appendChild(commentDiv);
        });
    }

    function clearHistory() {
        localStorage.removeItem('mySiteComments');
        allComments = [];
        renderComments();
    }

    function logout() {
        // hide comments
        document.getElementById('main-content').classList.add('hidden');
        // show login section
        document.getElementById('login-section').classList.remove('hidden');
        // clear previous username
        document.getElementById('username').value = "";
    }

</script>
</body>
</html>