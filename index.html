<html>
<head>
    <title>Comment Page!</title>
    <style>
        body { font-family: sens-serif; padding: 20px; }
        .hidden { display: none; } 
        #comment-list { border-top: 1px solid #ccc; margin-top: 20px; }
        .comment { background: #f4f4f4; padding: 10px; margin: 10px 0; border-radius: 5px; }
        small { color: #666; font-size: 0.8em; }
    </style>
</head>
<body>
    <h1>Comment Page!</h1>

    <div id="login-section">
        <input type="text" id="username" placeholder="Enter your name">
        <button onclick="login()">Login</button>
    </div>

    <div id="main-content" class="hidden">
        <p>Welcome, <span id="display-name"></span>!</p>
        
        <textarea id="comment-input" placeholder="Write a comment..."></textarea><br>
        <button onclick="addComment()">Post Comment</button>

        <h3>Comments:</h3>
        <div id="comment-list">
            </div>
    </div>

    <script>
        let currentUser = "";

        let allComments = JSON.parse(localStorage.getItem('mySiteComments')) || [];

        function login() {
            const nameInput = document.getElementById('username').value;
            if (nameInput.trim() !== "") {
                currentUser = nameInput;
                document.getElementById('display-name').innerText = currentUser;
                
                // now hide the login and show the comments
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                renderComments();
            }
        }

        function addComment() {
            const text = document.getElementById('comment-input').value;
            if (text.trim() === "") return;

            const newComment = {
                user: currentUser,
                text: text,
                timestamp: new Date().toLocaleString()
            }

            allComments.unshift(newComment);

            localStorage.setItem('mySiteComments', JSON.stringify(allComments));
            renderComments();
            document.getElementById('comment-input').value = "";
        }

        //vulnerability here!
        function renderComments(){
            const list = document.getElementById('comment-list');
            list.innerHTML = ""; 
            allComments.forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                
                commentDiv.innerHTML = `
                    <strong>${comment.user}</strong> <small>(${comment.timestamp})</small>
                    <p>${comment.text}</p>
                `;
                list.appendChild(commentDiv);
            });
        }
        //Potential Fix (treating it as plain text):
        <!-- function renderComments(){
        const list = document.getElementById('comment-list');
        list.innerHTML = "";

        allComments.forEach(comment => {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment';

            const strong = document.createElement('strong');
            strong.textContent = comment.user;

            const small = document.createElement('small');
            small.textContent = ` (${comment.timestamp})`;

            const p = document.createElement('p');
            p.textContent = comment.text;  // SAFE

            commentDiv.appendChild(strong);
            commentDiv.appendChild(small);
            commentDiv.appendChild(p);

            list.appendChild(commentDiv);
        });
    } -->



        function clearHistory() {
            localStorage.removeItem('mySiteComments');
            allComments = []; 
            renderComments(); 
        }
        
    </script>
</body>
</html>